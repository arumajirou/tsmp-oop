#!/usr/bin/env python
import ast, json, pathlib, sys, re
logs = sorted(pathlib.Path("ops/phase1").glob("run-*.log"))
if not logs: sys.exit("no run logs in ops/phase1")
raw = logs[-1].read_text(encoding="utf-8")
m = re.search(r"\{'.*?\}", raw, re.S)
if not m: sys.exit("no dict found in last run log")
data = ast.literal_eval(m.group(0))
path = pathlib.Path(f"ops/phase1/metrics-{logs[-1].stem.split('run-')[-1]}.json")
path.write_text(json.dumps(data, ensure_ascii=False, indent=2), encoding="utf-8")
print(str(path))
